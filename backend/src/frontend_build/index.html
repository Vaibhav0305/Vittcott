<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VittCott — Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js" defer></script>
  <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body class="bg-gray-900 text-gray-100 font-sans">
  <!-- Header -->
  <nav class="bg-gray-800 sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <i data-feather="trending-up" class="text-indigo-500"></i>
        <a href="index.html" class="text-xl font-bold">VittCott</a>
        <div class="hidden sm:flex gap-4 ml-6 text-gray-300">
          <a href="index.html">Home</a>
          <a href="/pages/stocks.html">Stocks</a>
          <a href="/pages/mutual-funds.html">MF</a>
          <a href="/pages/create-account.html">Create Account</a>
        </div>
      </div>

      <!-- RIGHT SIDE: assistant / upload / login -->
      <div class="flex items-center gap-3">
        <button id="open-ai-btn" class="px-3 py-2 bg-indigo-600 rounded">Assistant</button>

        <!-- Upload Portfolio button -->
        <button id="open-upload-btn" class="px-3 py-2 bg-green-600 rounded flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1M12 12v6M8 8l4-4 4 4" /></svg>
          Upload Portfolio
        </button>

        <a href="/pages/create-account.html" class="px-3 py-2 bg-indigo-500 rounded">Login / Signup</a>
      </div>
    </div>
  </nav>

  <!-- Upload widget (hidden by default) -->
  <div id="upload-widget" class="fixed right-6 bottom-24 z-50 w-80 bg-gray-800 border border-gray-700 rounded-lg p-4 shadow-2xl hidden">
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-sm font-semibold text-indigo-100">Upload Portfolio</h3>
      <button id="close-upload" class="text-gray-400 hover:text-gray-200">✕</button>
    </div>

    <input id="uc-username" placeholder="username" class="w-full px-3 py-2 mb-2 rounded bg-gray-900 border border-gray-700 text-gray-100" value="testuser" />
    <input id="uc-file" type="file" accept=".xlsx,.xls" class="w-full mb-3 text-gray-100" />

    <div class="flex gap-2">
      <button id="uc-uploadBtn" class="flex-1 px-3 py-2 bg-green-500 hover:bg-green-600 rounded text-white">Upload</button>
      <button id="uc-clearBtn" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-200">Clear</button>
    </div>

    <progress id="uc-progress" value="0" max="100" class="w-full mt-3 hidden"></progress>
    <div id="uc-status" class="text-sm text-gray-300 mt-2 break-words"></div>
  </div>

  <!-- Hero -->
  <header class="gradient-bg py-12">
    <div class="max-w-6xl mx-auto px-4 grid lg:grid-cols-2 gap-8 items-center">
      <div>
        <h1 class="text-4xl sm:text-5xl font-extrabold">Invest in your future with confidence</h1>
        <p class="mt-4 text-indigo-100">VittCott makes investing simple, accessible and student friendly.</p>
        <div class="mt-6 flex gap-3">
          <a href="/pages/create-account.html" class="px-5 py-3 bg-white text-indigo-600 rounded font-semibold">Get Started</a>
        </div>

        <div class="mt-6 grid grid-cols-2 gap-2">
          <button onclick="openAssistantWithPrompt('Suggest a beginner SIP plan')" class="px-3 py-2 bg-indigo-800/40 rounded">Ask: SIP plan</button>
          <button onclick="openAssistantWithPrompt('Top 5 long-term stocks in India')" class="px-3 py-2 bg-indigo-800/40 rounded">Ask: Stocks</button>
        </div>
      </div>
      <div>
        <img src="/assets/images/hero-placeholder.jpg" alt="Hero" class="rounded shadow-lg w-full object-cover">
      </div>
    </div>
  </header>

  <!-- Ticker -->
  <section class="bg-gray-800 py-3">
    <div class="max-w-6xl mx-auto px-4 flex items-center gap-6 overflow-hidden">
      <div class="font-bold">Live Markets:</div>
      <div class="ticker-tape flex gap-8 whitespace-nowrap">
        <div class="flex gap-2"><span class="text-green-400">NIFTY</span> 18,245 <span class="text-green-400">+124</span></div>
        <div class="flex gap-2"><span class="text-red-400">SENSEX</span> 61,420 <span class="text-red-400">-85</span></div>
        <div class="flex gap-2"><span class="text-green-400">GOLD</span> ₹5,245 <span class="text-green-400">+45</span></div>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="py-12 bg-gray-800">
    <div class="max-w-6xl mx-auto px-4 text-center mb-8">
      <h2 class="text-3xl font-bold">Why choose VittCott?</h2>
      <p class="text-gray-400">Student-focused tools + AI assistant for easier investing.</p>
    </div>
    <div class="max-w-6xl mx-auto px-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <div class="bg-gray-700 p-6 rounded card-hover">
        <div class="h-12 w-12 bg-indigo-500 rounded flex items-center justify-center text-white"><i data-feather="zap"></i></div>
        <h3 class="mt-4 font-semibold">Zero Commission</h3>
        <p class="text-gray-300">Trade with zero commission fees.</p>
      </div>
      <div class="bg-gray-50 text-gray-900 p-6 rounded card-hover">
        <div class="h-12 w-12 bg-green-500 rounded flex items-center justify-center text-white"><i data-feather="shield"></i></div>
        <h3 class="mt-4 font-semibold">Safe & Secure</h3>
        <p class="text-gray-700">Bank-level security.</p>
      </div>
      <div class="bg-gray-50 text-gray-900 p-6 rounded card-hover">
        <div class="h-12 w-12 bg-blue-500 rounded flex items-center justify-center text-white"><i data-feather="pie-chart"></i></div>
        <h3 class="mt-4 font-semibold">Smart Portfolio</h3>
        <p class="text-gray-700">AI-powered portfolio suggestions.</p>
      </div>
    </div>
  </section>

  <!-- Stocks preview -->
  <section id="stocks" class="py-12 bg-gray-800">
    <div class="max-w-6xl mx-auto px-4">
      <h2 class="text-2xl font-bold mb-4">Popular Stocks</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-gray-700 p-4 rounded"><strong>RELI</strong><div class="text-sm text-gray-400">Reliance — ₹2350</div></div>
        <div class="bg-gray-700 p-4 rounded"><strong>TCS</strong><div class="text-sm text-gray-400">TCS — ₹3200</div></div>
        <div class="bg-gray-700 p-4 rounded"><strong>INFY</strong><div class="text-sm text-gray-400">Infosys — ₹1400</div></div>
        <div class="bg-gray-700 p-4 rounded"><strong>HDFC</strong><div class="text-sm text-gray-400">HDFC — ₹2600</div></div>
      </div>
      <div class="mt-4"><a href="/pages/stocks.html" class="text-indigo-400">View all stocks →</a></div>
    </div>
  </section>

  <!-- CTA -->
  <section class="py-12 bg-gray-900">
    <div class="max-w-6xl mx-auto px-4 bg-gray-800 rounded p-6 grid lg:grid-cols-2 gap-4 items-center">
      <div>
        <h3 class="text-2xl font-bold">Ready to start investing?</h3>
        <p class="text-gray-400">Join VittCott and use the assistant to plan your investments.</p>
      </div>
      <div class="text-right">
        <a href="/pages/create-account.html" class="px-4 py-2 bg-indigo-600 rounded">Create Free Account</a>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-950 text-gray-300 py-8">
    <div class="max-w-6xl mx-auto px-4">
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div>
          <h4 class="font-semibold text-gray-400">Products</h4>
          <ul class="mt-2 space-y-2"><li><a href="/pages/stocks.html">Stocks</a></li><li><a href="/pages/mutual-funds.html">Mutual Funds</a></li></ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-400">Company</h4>
          <ul class="mt-2 space-y-2"><li>About</li><li>Careers</li></ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-400">Support</h4>
          <ul class="mt-2 space-y-2"><li>Help</li><li>Contact</li></ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-400">Connect</h4>
          <div class="mt-2">Socials</div>
        </div>
      </div>
      <div class="mt-8 text-center text-sm text-gray-500">© <span id="year">2025</span> VittCott</div>
    </div>
  </footer>

  <!-- Floating assistant button -->
  <button id="float-open" class="fixed right-6 bottom-6 z-50 px-4 py-3 bg-indigo-600 rounded-full shadow-lg">Assistant</button>

  <!-- Shared scripts -->
  <script>
    // CONFIG: change this to the correct URL for your setup:
    const ASSISTANT_URL = 'http://127.0.0.1:8501';

    // Elements
    const openHeaderBtn = document.getElementById('open-ai-btn');
    const floatOpenBtn = document.getElementById('float-open');

    function openAssistant(promptText = '') {
      let url = ASSISTANT_URL;
      if (promptText) {
        const sep = url.includes('?') ? '&' : '?';
        url = url + sep + 'prompt=' + encodeURIComponent(promptText);
      }
      window.open(url, '_blank');
    }
    function openAssistantWithPrompt(promptText='') { openAssistant(promptText); }
    if (openHeaderBtn) openHeaderBtn.addEventListener('click', () => openAssistant());
    if (floatOpenBtn) floatOpenBtn.addEventListener('click', () => openAssistant());
    document.addEventListener('DOMContentLoaded', () => {
      if (window.feather) feather.replace();
      if (window.AOS) AOS.init({duration:700});
      document.getElementById('year').textContent = new Date().getFullYear();
    });
  </script>

  <script src="/assets/js/app.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <!-- Upload widget script (placed at end so DOM is ready) -->
  <script>
    /* CONFIG: set the backend endpoints (full URL if backend runs on different host) */
    const PRESIGN_ENDPOINT = 'http://127.0.0.1:8000/presign';
    const REGISTER_ENDPOINT = 'http://127.0.0.1:8000/register';

    const openUploadBtn = document.getElementById('open-upload-btn');
    const uploadWidget = document.getElementById('upload-widget');
    const closeUpload = document.getElementById('close-upload');
    const uploadBtn = document.getElementById('uc-uploadBtn');
    const clearBtn = document.getElementById('uc-clearBtn');
    const fileInput = document.getElementById('uc-file');
    const usernameInput = document.getElementById('uc-username');
    const progressEl = document.getElementById('uc-progress');
    const statusEl = document.getElementById('uc-status');

    openUploadBtn.addEventListener('click', () => {
      uploadWidget.classList.remove('hidden');
    });
    closeUpload.addEventListener('click', () => {
      uploadWidget.classList.add('hidden');
    });

    clearBtn.addEventListener('click', () => {
      fileInput.value = '';
      statusEl.textContent = '';
      progressEl.classList.add('hidden');
      progressEl.value = 0;
    });

    uploadBtn.addEventListener('click', async () => {
      const username = usernameInput.value.trim();
      if (!username) { alert('Enter username'); return; }
      if (!fileInput.files.length) { alert('Choose an Excel file'); return; }
      const file = fileInput.files[0];

      statusEl.textContent = 'Requesting upload token...';
      // 1) Request presigned POST
      const presignResp = await fetch(PRESIGN_ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          filename: file.name,
          content_type: file.type || 'application/octet-stream',
          username: username
        })
      });

      if (!presignResp.ok) {
        const text = await presignResp.text();
        statusEl.textContent = 'Presign error: ' + text;
        return;
      }
      const presign = await presignResp.json();

      // 2) Upload to S3 with progress
      statusEl.textContent = 'Uploading to S3...';
      const formData = new FormData();
      Object.entries(presign.fields).forEach(([k,v]) => formData.append(k,v));
      formData.append('file', file);

      const xhr = new XMLHttpRequest();
      xhr.open('POST', presign.url, true);
      xhr.upload.onprogress = (e) => {
        if (e.lengthComputable) {
          progressEl.classList.remove('hidden');
          progressEl.value = (e.loaded / e.total) * 100;
        }
      };
      xhr.onload = async () => {
        if (xhr.status === 204 || xhr.status === 201 || xhr.status === 200) {
          statusEl.textContent = 'Upload succeeded. Registering...';
          const reg = await fetch(REGISTER_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: username, s3_key: presign.key, filename: file.name, size: file.size })
          });
          if (!reg.ok) {
            statusEl.textContent = 'Register failed: ' + await reg.text();
            return;
          }
          const j = await reg.json();
          statusEl.innerHTML = 'Done. <a class="text-green-400 underline" href="' + j.download_url + '" target="_blank">Open uploaded file (1 hour)</a>';
        } else {
          statusEl.textContent = 'S3 upload failed: ' + xhr.status + ' ' + xhr.responseText;
        }
      };
      xhr.onerror = () => {
        statusEl.textContent = 'Upload request error';
      };
      xhr.send(formData);
    });
  </script>

</body>
</html>
